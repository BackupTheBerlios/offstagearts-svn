<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html><head>
<meta name="description" content="This cryptography tutorial helps you understand: What is PKCS#8? What is PKCS#18? Reading and writing private keys in PKCS#8 format with 'openssl pkcs8'; Reading and writing key and certificate combination in PKCS#12 format with 'openssl pkcs12'; Converting between PKCS#12 files and JKS files 'keytool -importkeystore'."/> 
<meta name="keywords" content="Cryptography, Digital Security, Free, Tutorial, Book, , OpenSSL, keytool, Keys, Migrating, keystore, PKCS#8, PKCS#12"/>
<title>Cryptography Tutorials - Herong's Tutorial Notes - Key Formats PKCS#8 and PKCS#12 and Migration</title>
<script type="text/javascript" src="_head.js"></script>
<link rel="stylesheet" type="text/css" href="book.css"/>
</head><body>

<div class="hy_body">
<table class="frame" cellspacing="0" cellpadding="0">

<tr><td class="frame_top" colspan="3">
<script type="text/javascript">writeTop("Crypto");</script>
</td></tr>

<tr><td class="frame_left">
<script type="text/javascript">writeLeft("Crypto");</script>
</td>
<td class="frame_center">

<table class="page_border" cellspacing="0" cellpadding="0">
<tr><td></td>
<td>

<table class="page" cellspacing="0" cellpadding="0">
<tr><td>

<table cellspacing="0" cellpadding="0" border="0">
<tr><td align="left" colspan="3"><b>Cryptography Tutorials - Herong's Tutorial Notes</b></td></tr>
<tr><td align="left">Dr. Herong Yang, Version 4.00</td>
<td align="center"></td>
<td align="right">
<script type="text/javascript">writeMenu("Crypto");</script>
</td></tr>
<tr><td class="page_line" colspan="3"><img height="1" width="100%" src="dot.gif" alt=""/></td></tr>
<tr><td class="body" colspan="3">
<!-- begin of body -->

<script type="text/javascript">adsBottom();</script>
<script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js"></script>

<table><tr><td class="page_sw">

<script type="text/javascript">adsLeft();</script>
<script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js"></script>
<script type="text/javascript">writePageLeft("http://www.herongyang.com/crypto");</script>

</td><td class="page_se">

<div class="gg_search"><p><form method="get" action="http://www.google.com/custom" target="_top">
<input type="hidden" name="domains" value="www.herongyang.com"></input>
<input type="hidden" name="client" value="pub-8765173615603734"></input>
<input type="hidden" name="forid" value="1"></input>
<input type="hidden" name="ie" value="ISO-8859-1"></input>
<input type="hidden" name="oe" value="ISO-8859-1"></input>
<input type="hidden" name="cof" value="GALT:#008000;GL:1;DIV:#336699;VLC:663399;AH:center;BGC:FFFFFF;LBGC:336699;ALC:0000FF;LC:0000FF;T:000000;GFNT:0000FF;GIMP:0000FF;FORID:1;"></input>
<input type="hidden" name="hl" value="en"></input>
<input type="text" name="q" size="38" maxlength="255" value=""></input>
<input type="submit" name="sa" value="Search"></input>
<input type="radio" name="sitesearch" value="www.herongyang.com" checked="checked"></input>
<font size="-1" color="#000000">This site</font>
<input type="radio" name="sitesearch" value=""></input>
<font size="-1" color="#000000">Web</font>
<a href="http://www.google.com/">
<img src="http://www.google.com/logos/Logo_25wht.gif"
border="0" alt="Google" style="vertical-align: middle"/></a>
</form><p></div>



<p class="chapter_title" id="Key_Formats_PKCS8_PKCS12.html">
Key Formats PKCS#8 and PKCS#12 and Migration
</p>


<p class="part_list">Part: &nbsp; 
<a href="Key_Formats_PKCS8_PKCS12.html">1</a>&nbsp;
<a href="Key_Formats_PKCS8_PKCS12_2.html">2</a>&nbsp;
<a href="Key_Formats_PKCS8_PKCS12_3.html">3</a>&nbsp;
<span class="part_list_curr">4</span>&nbsp;
</p>

<p><i>(Continued from previous part...)</i></p>

<p>
Notes on the commands and options I used:
</p>
<ul>
<li>"keytool -list" command lists what's in the keystore file.
</li>
<li>"-keystore openssl_key_crt.p12" option specifies the keystore file, a PKCS#12 file generated by "OpenSSL".
</li>
<li>"-storetype pkcs12" option specifies the type of the keystore file, "jks" or "pkcs12".
</li>
<li>"-storepass p12pass" option specifies the password to open the keystore file.
</li>
<li>"keytool -exportcert" command exports the self-signed certificate out of the keystore file.
</li>
<li>"-rfc" option tells keytool to write the certificate file with PEM (RFC1421) encoding. 
</li>
</ul>

<p>
The tests were successful and helped me to learn that:
</p>
<ul>
<li>The PKCS#12 file generated by "OpenSSL" does meet the PKCS#12 standard. 
</li>
<li>"OpenSSL" and "keytool" can share keystore files in PKCS#12 format.
</li>
</ul>

<p>
As an exercise, you can open "openssl_crt.pem" and "keytool_openssl_crt.pem".
They should contain the same Base64 encoded strings.
</p>

<p>
In the next section, I want to try to convert the PKCS#12 file to a JKS (Java KeyStore) file.
</p>


<p class="section_title">
"keytool" Converting PKCS12 to JKS
</p>

<p>
Since Java uses JKS (Java KeyStore) as the keystore file type, 
I want to try to convert my PKCS#12 file, openssl_key_crt.p12, to a JKS file
with the "keystore -importkeystore" command:
</p>
<pre class="block_source">
>keytool -importkeystore -srckeystore openssl_key_crt.p12 
-srcstoretype pkcs12 -srcstorepass p12pass -srcalias openssl_key_crt 
-destkeystore openssl_key_crt.jks -deststoretype jks 
-deststorepass jkspass

>keytool -list -keystore openssl_key_crt.jks -storetype jks 
-storepass jkspass

Keystore type: JKS
Keystore provider: SUN

Your keystore contains 1 entry

openssl_key_crt, Jul 29, 2007, PrivateKeyEntry,
Certificate fingerprint (MD5): 1D:D4:AC:96:53:25:9F:1A:D0:A7:46:6C...
</pre>

<p>
There was no trouble at all. "keytool -importkeystore" command
has a lots of options. But they are very easy to understand.
</p>


<p class="section_title">
Summary - Migrating "OpenSSL" Keys to "keytool"
</p>

<p>
As a summary, I want offer some notes here about migrating private keys from "OpenSSL" files 
to "keytool" keystore files:
</p>

<p>
There is no easy way to just migrate the private keys from "OpenSSL" key files to "keytool" keystore files.
</p>

<p>
"openssl pkcs12 -export" command should be used to combine the private key file and the self-signed 
certificate file in a PKCS#12 file.
</p>

<p>
"keytool" can use the PKCS#12 file directly with the "-storetype pkcs12" open.
</p>

<p>
"keytool -importkeystore" command should be used to convert the PKCS#12 file into a JKS (Java KeyStore) file.
</p>


<p class="section_title">
Summary - Migrating "keytool" Keys to "OpenSSL"
</p>

<p>
PKCS#12 files can also be used to migrate private keys from "keytool" keystore files 
"OpenSSL" key files. Here are my notes on how to do this: 
</p>

<p>
There is no easy way to just migrate the private keys from "keytool" keystore files to "OpenSSL" key files.
My "DumpKey.java" program can do this. See other chapters in the book, if you want to try it.
</p>

<p>
"keytool -importkeystore" command should be used to convert a JKS (Java KeyStore) file into a PKCS#12 file.
</p>

<p>
"openssl pkcs12" command should be used to split the private key file out of the PKCS#12 file.
</p>

<p>
"openssl pkcs12" command should be used to split the certificate file out of the PKCS#12 file.
</p>


<p class="section_title">
Conclusion
</p>

<ul>
<li>PKCS#8 is designed as the Private-Key Information Syntax Standard. It defines what should be included 
in a private key file. 
</li>
<li>PKCS#12 is designed as the Personal Information Exchange Syntax Standard. It defines how to package
a private key and its certificates into a single file.
</li>
<li>"openssl pkcs8" command can be used to read and write private keys in PKCS#8 format. 
</li>
<li>"openssl pkcs12" command can be used to read and write PKCS#12 files. 
</li>
<li>"keytool -importkeystore" command can be used to between PKCS#12 files and JKS files.
</li>
</ul>





<p class="part_list">Part: &nbsp; 
<a href="Key_Formats_PKCS8_PKCS12.html">1</a>&nbsp;
<a href="Key_Formats_PKCS8_PKCS12_2.html">2</a>&nbsp;
<a href="Key_Formats_PKCS8_PKCS12_3.html">3</a>&nbsp;
<span class="part_list_curr">4</span>&nbsp;
</p>

<script type="text/javascript">adsTop();</script>
<script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js"></script>

<script type="text/javascript">showPageFooter("http://www.herongyang.com/crypto", "Key_Formats_PKCS8_PKCS12.html");</script>

</td></tr></table>

<!-- end of body -->
<p></p>
<script type="text/javascript">adsBottom();</script>
<script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js"></script>

</td></tr>
<tr><td class="page_line" colspan="3"><img height="1" width="100%" src="dot.gif" alt=""/></td></tr>
<tr><td align="left">Dr. Herong Yang, updated in 2007</td>
<td align="center"></td>
<td align="right"><script type="text/javascript">writeMenu("Crypto");</script></td>
</tr>
<tr><td align="left" colspan="3"><b>Cryptography Tutorials - Herong's Tutorial Notes - Key Formats PKCS#8 and PKCS#12 and Migration</b></td></tr>
</table>

</td></tr>
</table>

</td>
<td rowspan="1"><img height="100%" width="1" src="dot.gif" alt=""/></td></tr>
</table>

</td>

<td class="frame_right">
<script type="text/javascript">writeRight("Crypto");</script>
</td></tr>
<tr><td class="frame_bottom" colspan="3">
<script type="text/javascript">writeBottom("Crypto");</script>
</td></tr>
</table>
</div>
</body></html>

