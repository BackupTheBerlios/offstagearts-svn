<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html><head>
<meta name="description" content="This cryptography tutorial helps you understand: Setting Up OpenSSL to be used as a CA; Using OpenSSL to generate CA's key pair; Using OpenSSL to self-sign CA's certificate; Using keytool to generate a CSR; Using OpenSSL to sign a CSR; Using keytool to import signed certificates."/> 
<meta name="keywords" content="Cryptography, Digital Security, Free, Tutorial, Book, , OpenSSL, keytool, CSR, Sign, keystore, Certificate"/>
<title>Cryptography Tutorials - Herong's Tutorial Notes - 'OpenSSL' Signing CSR Generated by 'keytool'</title>
<script type="text/javascript" src="_head.js"></script>
<link rel="stylesheet" type="text/css" href="book.css"/>
</head><body>

<div class="hy_body">
<table class="frame" cellspacing="0" cellpadding="0">

<tr><td class="frame_top" colspan="3">
<script type="text/javascript">writeTop("Crypto");</script>
</td></tr>

<tr><td class="frame_left">
<script type="text/javascript">writeLeft("Crypto");</script>
</td>
<td class="frame_center">

<table class="page_border" cellspacing="0" cellpadding="0">
<tr><td></td>
<td>

<table class="page" cellspacing="0" cellpadding="0">
<tr><td>

<table cellspacing="0" cellpadding="0" border="0">
<tr><td align="left" colspan="3"><b>Cryptography Tutorials - Herong's Tutorial Notes</b></td></tr>
<tr><td align="left">Dr. Herong Yang, Version 4.00</td>
<td align="center"></td>
<td align="right">
<script type="text/javascript">writeMenu("Crypto");</script>
</td></tr>
<tr><td class="page_line" colspan="3"><img height="1" width="100%" src="dot.gif" alt=""/></td></tr>
<tr><td class="body" colspan="3">
<!-- begin of body -->

<script type="text/javascript">adsBottom();</script>
<script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js"></script>

<table><tr><td class="page_sw">

<script type="text/javascript">adsLeft();</script>
<script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js"></script>
<script type="text/javascript">writePageLeft("http://www.herongyang.com/crypto");</script>

</td><td class="page_se">

<div class="gg_search"><p><form method="get" action="http://www.google.com/custom" target="_top">
<input type="hidden" name="domains" value="www.herongyang.com"></input>
<input type="hidden" name="client" value="pub-8765173615603734"></input>
<input type="hidden" name="forid" value="1"></input>
<input type="hidden" name="ie" value="ISO-8859-1"></input>
<input type="hidden" name="oe" value="ISO-8859-1"></input>
<input type="hidden" name="cof" value="GALT:#008000;GL:1;DIV:#336699;VLC:663399;AH:center;BGC:FFFFFF;LBGC:336699;ALC:0000FF;LC:0000FF;T:000000;GFNT:0000FF;GIMP:0000FF;FORID:1;"></input>
<input type="hidden" name="hl" value="en"></input>
<input type="text" name="q" size="38" maxlength="255" value=""></input>
<input type="submit" name="sa" value="Search"></input>
<input type="radio" name="sitesearch" value="www.herongyang.com" checked="checked"></input>
<font size="-1" color="#000000">This site</font>
<input type="radio" name="sitesearch" value=""></input>
<font size="-1" color="#000000">Web</font>
<a href="http://www.google.com/">
<img src="http://www.google.com/logos/Logo_25wht.gif"
border="0" alt="Google" style="vertical-align: middle"/></a>
</form><p></div>



<p class="chapter_title" id="OpenSSL_Signing_keytool_CSR.html">
'OpenSSL' Signing CSR Generated by 'keytool'
</p>


<p class="part_list">Part: &nbsp; 
<span class="part_list_curr">1</span>&nbsp;
<a href="OpenSSL_Signing_keytool_CSR_2.html">2</a>&nbsp;
<a href="OpenSSL_Signing_keytool_CSR_3.html">3</a>&nbsp;
<a href="OpenSSL_Signing_keytool_CSR_4.html">4</a>&nbsp;
<a href="OpenSSL_Signing_keytool_CSR_5.html">5</a>&nbsp;
<a href="OpenSSL_Signing_keytool_CSR_6.html">6</a>&nbsp;
</p>



<p>
After I published my notes on "OpenSSL" and "keytool", many viewers have asked questions 
about the compatibility between those two tools. In this chapter, I will test how "OpenSSL" 
and "keytool" can work together with following scenarios:
</p>
<ul>
<li>Setting Up "OpenSSL" to be used as a CA (Certificate Authority).
</li>
<li>Using "OpenSSL" to generate CA's private and public key pair.
</li>
<li>Using "OpenSSL" to self-sign CA's public key certificate.
</li>
<li>Using "keytool" to generate a private and public key pair.
</li>
<li>Using "keytool" to generate a CSR (Certificate Sign Request) from a key pair.
</li>
<li>Using "OpenSSL" to sign a CSR with CA's key pair and public key certificate.
</li>
<li>Using "keytool" to import signed certificates into keystore files. 
</li>
</ul>


<p class="section_title">
Using OpenSSL to Act as a CA (Certificate Authority)
</p>

<p>
If I want to act as a CA (Certificate Authority), I must have a tool 
to sign other people's CSR (Certificate Signing Request). As we learned from 
previous tutorials, "keytool" can not sign CSR. So I must use "OpenSSL"
to act as a CA.
</p>

<p>
Here is a list of things I need to do with "OpenSSL" as a CA:
</p>
<ul>
<li>Install "OpenSSL" installed properly and create configuration file, openssl.cnf. 
</li>
<li>Created a CA private key file with 2048-bit keys, and protect it with a password. 
</li>
<li>Self-sign my CA public key certificate, which can be given out to anyone.
</li>
</ul>

<p>
Let's check the "OpenSSL" installation first. If "OpenSSL" was installed at \local\GnuWin32\, 
the following command should report back the version number:
</p> 
<pre class="block_source">
>\local\gnuwin32\bin\openssl version

OpenSSL 0.9.7c 30 Sep 2003

>set path=&lt;old_path&gt;;\local\gnuwin32\bin\
</pre>

<p>
To save typing time, I added \local\gnuwin32\bin\ to the PATH environment variable as shown above.
</p>

<p>
Then look at the configuration file, openssl.cnf, which is needed only when I self-signing my CA public certificate.
I can use the openssl.cnf as is without any changes. But if I want to put in my CA distinguished name information
to save time when  self-signing my CA public certificate:
</p>
<pre class="block_source">
countryName_default             = CA
stateOrProvinceName_default     = HY State
localityName_default            = HY City
0.organizationName_default      = HY Company
organizationalUnitName_default  = HY Unit 
commonName_default              = Herong Yang
emailAddress_default            = herongyang.com
</pre>

<p>
So I am ready to generated my CA private key as described in the next section.
</p>


<p class="section_title">
"OpenSSL" Generating CA's Private Key
</p>

<p>As a CA, I must have good private key and securely store it in a file.
This can be done with a single OpenSSL command "openssl genrsa"
as shown in the following command window session:
</p>
<pre class="block_source">
>openssl genrsa -out herong.key -des 2048

Loading 'screen' into random state - done
Generating RSA private key, 2048 bit long modulus
..........................................................+++
.......................+++
e is 65537 (0x10001)
Enter pass phrase for herong.key: keypass
Verifying - Enter pass phrase for herong.key: keypass

>type herong.key

-----BEGIN RSA PRIVATE KEY-----
Proc-Type: 4,ENCRYPTED
DEK-Info: DES-CBC,65D5EB070215060E

l5d+v8KbkPwCgFlrsMD+5FpVsldoCZPeCjMrrWzyym5wIKHKqVltfAjO...
Z2JBXMGxAV4kGky0Jca6/Kxb/tWAmJci0YaDXO0EjwTxeulj9MVL5t3m...
...
bHbZhRs6lUxB4PNosjkhZrgPzYRD7A3EmVqo6ZLXeYO2I2lVIe7k+Lec...
-----END RSA PRIVATE KEY-----
</pre> 

<p>
Notes about what I did here:
</p>
<ul>
<li>"genrsa" command is used to generate a pair of private key and public key using RSA algorithm.
</li>
<li>"-out herong.key" tells openssl to store the private key in a file called herong.key. 
</li>
<li>"-des" option is used to encrypt my private key file "herong.key" with DES algorithm.
</li>
<li>"2048" used to force openssl to generate keys a length of 2048 bits. The default length is 512. 
Longer keys give better protection.
</li>
<li>"-outpass keypass" is not used on the command line, because it does not work (See the test below). 
So I entered it when "OpenSSL" prompted for it. 
</li>
<li>"type herong.key" is Windows command to shows the content of "herong.key".
</li>
</ul>

<p>
Error message received when "-outpass keypass" is used:
</p>
<pre class="block_source">
>openssl genrsa -out test.key -des -passout keypass 2048
Invalid password argument "keypass"
Error getting password
</pre>

<p><i>(Continued on next part...)</i></p>



<p class="part_list">Part: &nbsp; 
<span class="part_list_curr">1</span>&nbsp;
<a href="OpenSSL_Signing_keytool_CSR_2.html">2</a>&nbsp;
<a href="OpenSSL_Signing_keytool_CSR_3.html">3</a>&nbsp;
<a href="OpenSSL_Signing_keytool_CSR_4.html">4</a>&nbsp;
<a href="OpenSSL_Signing_keytool_CSR_5.html">5</a>&nbsp;
<a href="OpenSSL_Signing_keytool_CSR_6.html">6</a>&nbsp;
</p>

<script type="text/javascript">adsTop();</script>
<script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js"></script>

<script type="text/javascript">showPageFooter("http://www.herongyang.com/crypto", "OpenSSL_Signing_keytool_CSR.html");</script>

</td></tr></table>

<!-- end of body -->
<p></p>
<script type="text/javascript">adsBottom();</script>
<script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js"></script>

</td></tr>
<tr><td class="page_line" colspan="3"><img height="1" width="100%" src="dot.gif" alt=""/></td></tr>
<tr><td align="left">Dr. Herong Yang, updated in 2007</td>
<td align="center"></td>
<td align="right"><script type="text/javascript">writeMenu("Crypto");</script></td>
</tr>
<tr><td align="left" colspan="3"><b>Cryptography Tutorials - Herong's Tutorial Notes - 'OpenSSL' Signing CSR Generated by 'keytool'</b></td></tr>
</table>

</td></tr>
</table>

</td>
<td rowspan="1"><img height="100%" width="1" src="dot.gif" alt=""/></td></tr>
</table>

</td>

<td class="frame_right">
<script type="text/javascript">writeRight("Crypto");</script>
</td></tr>
<tr><td class="frame_bottom" colspan="3">
<script type="text/javascript">writeBottom("Crypto");</script>
</td></tr>
</table>
</div>
</body></html>

