<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html><head>
<meta name="description" content="This cryptography tutorial helps you understand: Setting Up OpenSSL to be used as a CA; Using OpenSSL to generate CA's key pair; Using OpenSSL to self-sign CA's certificate; Using keytool to generate a CSR; Using OpenSSL to sign a CSR; Using keytool to import signed certificates."/> 
<meta name="keywords" content="Cryptography, Digital Security, Free, Tutorial, Book, , OpenSSL, keytool, CSR, Sign, keystore, Certificate"/>
<title>Cryptography Tutorials - Herong's Tutorial Notes - 'OpenSSL' Signing CSR Generated by 'keytool'</title>
<script type="text/javascript" src="_head.js"></script>
<link rel="stylesheet" type="text/css" href="book.css"/>
</head><body>

<div class="hy_body">
<table class="frame" cellspacing="0" cellpadding="0">

<tr><td class="frame_top" colspan="3">
<script type="text/javascript">writeTop("Crypto");</script>
</td></tr>

<tr><td class="frame_left">
<script type="text/javascript">writeLeft("Crypto");</script>
</td>
<td class="frame_center">

<table class="page_border" cellspacing="0" cellpadding="0">
<tr><td></td>
<td>

<table class="page" cellspacing="0" cellpadding="0">
<tr><td>

<table cellspacing="0" cellpadding="0" border="0">
<tr><td align="left" colspan="3"><b>Cryptography Tutorials - Herong's Tutorial Notes</b></td></tr>
<tr><td align="left">Dr. Herong Yang, Version 4.00</td>
<td align="center"></td>
<td align="right">
<script type="text/javascript">writeMenu("Crypto");</script>
</td></tr>
<tr><td class="page_line" colspan="3"><img height="1" width="100%" src="dot.gif" alt=""/></td></tr>
<tr><td class="body" colspan="3">
<!-- begin of body -->

<script type="text/javascript">adsBottom();</script>
<script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js"></script>

<table><tr><td class="page_sw">

<script type="text/javascript">adsLeft();</script>
<script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js"></script>
<script type="text/javascript">writePageLeft("http://www.herongyang.com/crypto");</script>

</td><td class="page_se">

<div class="gg_search"><p><form method="get" action="http://www.google.com/custom" target="_top">
<input type="hidden" name="domains" value="www.herongyang.com"></input>
<input type="hidden" name="client" value="pub-8765173615603734"></input>
<input type="hidden" name="forid" value="1"></input>
<input type="hidden" name="ie" value="ISO-8859-1"></input>
<input type="hidden" name="oe" value="ISO-8859-1"></input>
<input type="hidden" name="cof" value="GALT:#008000;GL:1;DIV:#336699;VLC:663399;AH:center;BGC:FFFFFF;LBGC:336699;ALC:0000FF;LC:0000FF;T:000000;GFNT:0000FF;GIMP:0000FF;FORID:1;"></input>
<input type="hidden" name="hl" value="en"></input>
<input type="text" name="q" size="38" maxlength="255" value=""></input>
<input type="submit" name="sa" value="Search"></input>
<input type="radio" name="sitesearch" value="www.herongyang.com" checked="checked"></input>
<font size="-1" color="#000000">This site</font>
<input type="radio" name="sitesearch" value=""></input>
<font size="-1" color="#000000">Web</font>
<a href="http://www.google.com/">
<img src="http://www.google.com/logos/Logo_25wht.gif"
border="0" alt="Google" style="vertical-align: middle"/></a>
</form><p></div>



<p class="chapter_title" id="OpenSSL_Signing_keytool_CSR.html">
'OpenSSL' Signing CSR Generated by 'keytool'
</p>


<p class="part_list">Part: &nbsp; 
<a href="OpenSSL_Signing_keytool_CSR.html">1</a>&nbsp;
<a href="OpenSSL_Signing_keytool_CSR_2.html">2</a>&nbsp;
<a href="OpenSSL_Signing_keytool_CSR_3.html">3</a>&nbsp;
<a href="OpenSSL_Signing_keytool_CSR_4.html">4</a>&nbsp;
<span class="part_list_curr">5</span>&nbsp;
<a href="OpenSSL_Signing_keytool_CSR_6.html">6</a>&nbsp;
</p>

<p><i>(Continued from previous part...)</i></p>

<p class="section_title">
"keytool" Managing Serial Numbers when Signing CSR
</p>

<p>
One error I had when using the "openssl x509 -req" command without providing serial number options. 
"OpenSSL" will give you an error like this: 
</p>
<pre class="block_source">
>openssl x509 -req -in maria.csr -CA herong.crt 
-CAkey herong.key -out maria.crt -days 365

Loading 'screen' into random state - done
Signature ok
subject=/C=AT/ST=Maria State/L=Maria City/O=Maria Company
/OU=Maria Unit/CN=Maria Teresa
Getting CA Private Key
Enter pass phrase for herong.key: keypass
herong.srl: No such file or directory
2744:error:02001002:system library:fopen:No such file or directory:
bss_file.c:276:fopen('herong.srl','rb')
2744:error:20074002:BIO routines:FILE_CTRL:system lib:bss_file.c:278:
</pre> 

<p>
"OpenSSL" will try to open a file named "herong.srl". The error message is not clear at all.
It does not say that "herong.srl" is the serial number file. 
There are 3 ways to supply a serial number to the "openssl x509 -req" command:
</p>
<ul>
<li>Create a text file named as "herong.srl" and put a number in the file.
</li>
<li>Use the "-set_serial n" option to specify a number each time.
</li>
<li>Use the "-CAcreateserial -CAserial herong.seq" option to let "OpenSSL" to create and manage the serial number.
</li>
</ul>


<p class="section_title">
"keytool" Importing CA's Certificate into Keystore Files
</p>

<p>
When Maria receives my CA self-signed public key certificate file, 
she needs to imported it into her keystore file with the "keytool -importcert" command
as shown below:
</p>
<pre class="block_source">
>keytool -importcert -alias herong_crt -keypass keypass 
-file herong.crt -keystore maria.jks -storepass jkspass

Owner: EMAILADDRESS=herongyang.com, CN=Herong Yang, 
OU=HY Unit, O=HY Company, L=HY City, ST=HY State, C=HY
Issuer: EMAILADDRESS=herongyang.com, CN=Herong Yang, 
OU=HY Unit, O=HY Company, L=HY City, ST=HY State, C=HY
Serial number: 0
Valid from: Sun Apr 1:42:10 EDT 2007 
until: Wed Mar 29 23:42:10 EDT 2017
Certificate fingerprints:
         MD5:  2D:95:8D:5F:0F:4A:9B:CC:A2:69:61:F6:22:AE...
         SHA1: 1F:BB:C7:78:97:AC:C8:BF:7B:A4:88:DF:B5:62...
         Signature algorithm name: MD5withRSA
         Version: 3

Extensions:

#1: ObjectId: 2.5.29.14 Criticality=false
SubjectKeyIdentifier [
KeyIdentifier [
...

[EMAILADDRESS=herongyang.com, CN=Herong Yang, OU=HY Unit, 
O=HY Company, L=HY City, ST=HY State, C=HY]
SerialNumber: [    00]
]

Trust this certificate? [no]:  yes
Certificate was added to keystore
</pre>

<p>
Notes on what Maria did:
</p>
<ul>
<li>"keytool -importcert" commands imports a certificate into a keystore file.
</li>
<li>"-alias herong_crt" option specifies a new entry name for the imported certificate.
</li>
<li>"-keypass keypass" option specifies a password to protect this new entry.
</li>
<li>"-file herong.crt" option specifies the file name of certificate to be imported.
</li>
<li>"-keystore maria.jks -storepass jkspass" option specifies the keystore file name and its password.
</li>
<li>Maria entered "yes" when "keytool" asked to trust this certificate or not.
</li>
</ul>

<p>
Want to see if the certificate was imported correctly or not? 
Try this "keytool -list" command:
</p>
<pre class="block_source">
>keytool -list -keystore maria.jks -storepass jkspass

Keystore type: JKS
Keystore provider: SUN

Your keystore contains 2 entries

maria_key, Apr 1, 2007, PrivateKeyEntry,
Certificate fingerprint (MD5): 54:5A:E8:77:30:82:B4:EB:C...
herong_crt, Apr 1, 2007, trustedCertEntry,
Certificate fingerprint (MD5): C1:6C:FE:38:F7:0F:71:23:3...
</pre>

<p>
As we can see, my CA certificate was imported ok and stored as a "trustedCertEntry".
So certificates generated by "OpenSSL" is compatible with "keytool" certificate format.
</p>

<p>
If Maria made a mistake when import my certificate, she could use this command
to delete my certificate from her keystore file:
</p>
<pre class="block_source">
>keytool -delete -alias herong_crt -keystore maria.jks 
-storepass jkspass
</pre>

<p>
Now Maria is ready to import her own public key certificate signed by me
as described in the next section.
</p>


<p><i>(Continued on next part...)</i></p>



<p class="part_list">Part: &nbsp; 
<a href="OpenSSL_Signing_keytool_CSR.html">1</a>&nbsp;
<a href="OpenSSL_Signing_keytool_CSR_2.html">2</a>&nbsp;
<a href="OpenSSL_Signing_keytool_CSR_3.html">3</a>&nbsp;
<a href="OpenSSL_Signing_keytool_CSR_4.html">4</a>&nbsp;
<span class="part_list_curr">5</span>&nbsp;
<a href="OpenSSL_Signing_keytool_CSR_6.html">6</a>&nbsp;
</p>

<script type="text/javascript">adsTop();</script>
<script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js"></script>

<script type="text/javascript">showPageFooter("http://www.herongyang.com/crypto", "OpenSSL_Signing_keytool_CSR.html");</script>

</td></tr></table>

<!-- end of body -->
<p></p>
<script type="text/javascript">adsBottom();</script>
<script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js"></script>

</td></tr>
<tr><td class="page_line" colspan="3"><img height="1" width="100%" src="dot.gif" alt=""/></td></tr>
<tr><td align="left">Dr. Herong Yang, updated in 2007</td>
<td align="center"></td>
<td align="right"><script type="text/javascript">writeMenu("Crypto");</script></td>
</tr>
<tr><td align="left" colspan="3"><b>Cryptography Tutorials - Herong's Tutorial Notes - 'OpenSSL' Signing CSR Generated by 'keytool'</b></td></tr>
</table>

</td></tr>
</table>

</td>
<td rowspan="1"><img height="100%" width="1" src="dot.gif" alt=""/></td></tr>
</table>

</td>

<td class="frame_right">
<script type="text/javascript">writeRight("Crypto");</script>
</td></tr>
<tr><td class="frame_bottom" colspan="3">
<script type="text/javascript">writeBottom("Crypto");</script>
</td></tr>
</table>
</div>
</body></html>

